
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>ELK部署整改 · DevOps Pages</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Zeng">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="elk-grafana.html" />
    
    
    <link rel="prev" href="k8s-elk-auth-kibana-via-ad.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../SUMMARY.html">
            
                <a href="../../SUMMARY.html">
            
                    
                    目 录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../">
            
                <a href="../../">
            
                    
                    DevOps
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">应用部署</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../deployment/ansible/">
            
                <a href="../deployment/ansible/">
            
                    
                    Ansible
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../deployment/ansible/ansible-intro.html">
            
                <a href="../deployment/ansible/ansible-intro.html">
            
                    
                    简介
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../deployment/docker/">
            
                <a href="../deployment/docker/">
            
                    
                    Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../normal/docker-learning.html">
            
                <a href="../normal/docker-learning.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../deployment/docker/docker-prometheus.html">
            
                <a href="../deployment/docker/docker-prometheus.html">
            
                    
                    Prometheus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../deployment/docker/docker-nginx-consul.html">
            
                <a href="../deployment/docker/docker-nginx-consul.html">
            
                    
                    Nginx Consul
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../deployment/docker/docker-pmm.html">
            
                <a href="../deployment/docker/docker-pmm.html">
            
                    
                    PMM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="../deployment/docker/docker-redis.html">
            
                <a href="../deployment/docker/docker-redis.html">
            
                    
                    Redis in Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.6" data-path="../deployment/docker/docker-ldap.html">
            
                <a href="../deployment/docker/docker-ldap.html">
            
                    
                    LDAP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.7" data-path="../deployment/docker/docker-harbor.html">
            
                <a href="../deployment/docker/docker-harbor.html">
            
                    
                    Harbor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.8" data-path="../deployment/docker/docker-apollo.html">
            
                <a href="../deployment/docker/docker-apollo.html">
            
                    
                    Apollo
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../deployment/k8s/">
            
                <a href="../deployment/k8s/">
            
                    
                    Kubernetes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../normal/k8s-learning.html">
            
                <a href="../normal/k8s-learning.html">
            
                    
                    K8s
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../deployment/k8s/installation/">
            
                <a href="../deployment/k8s/installation/">
            
                    
                    安装
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.2.1" data-path="../deployment/k8s/installation/kubespray-k8s/kubespray-k8s.html">
            
                <a href="../deployment/k8s/installation/kubespray-k8s/kubespray-k8s.html">
            
                    
                    Kubespray
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2.2" data-path="../deployment/k8s/installation/rke-k8s/rke-k8s.html">
            
                <a href="../deployment/k8s/installation/rke-k8s/rke-k8s.html">
            
                    
                    RKE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2.3" data-path="../deployment/k8s/installation/rancher-k8s/rancher-k8s.html">
            
                <a href="../deployment/k8s/installation/rancher-k8s/rancher-k8s.html">
            
                    
                    Rancher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2.4" data-path="../deployment/k8s/installation/kubeadm-k8s/kubeadm-k8s-steps.html">
            
                <a href="../deployment/k8s/installation/kubeadm-k8s/kubeadm-k8s-steps.html">
            
                    
                    Kubeadm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../deployment/k8s/deployment/">
            
                <a href="../deployment/k8s/deployment/">
            
                    
                    部署
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.3.1" data-path="../deployment/k8s/deployment/Kubernetes-dashboard.html">
            
                <a href="../deployment/k8s/deployment/Kubernetes-dashboard.html">
            
                    
                    K8s Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.2" data-path="../deployment/k8s/deployment/ELK.html">
            
                <a href="../deployment/k8s/deployment/ELK.html">
            
                    
                    ELK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.3" data-path="../deployment/k8s/deployment/k8s-prometheus.html">
            
                <a href="../deployment/k8s/deployment/k8s-prometheus.html">
            
                    
                    Prometheus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.4" data-path="../deployment/k8s/deployment/k8s-nfs-storageclass.html">
            
                <a href="../deployment/k8s/deployment/k8s-nfs-storageclass.html">
            
                    
                    NFS动态PV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.5" data-path="../deployment/k8s/deployment/k8s-rancher.html">
            
                <a href="../deployment/k8s/deployment/k8s-rancher.html">
            
                    
                    Rancher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3.6" data-path="../deployment/k8s/deployment/k8s-helm.html">
            
                <a href="../deployment/k8s/deployment/k8s-helm.html">
            
                    
                    Helm&Tiller
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../deployment/else/">
            
                <a href="../deployment/else/">
            
                    
                    其它
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../deployment/else/mysql-replication.html">
            
                <a href="../deployment/else/mysql-replication.html">
            
                    
                    MySQL主从复制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../deployment/else/percona-toolkit.html">
            
                <a href="../deployment/else/percona-toolkit.html">
            
                    
                    Percona toolkit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="../deployment/else/ins_mysql.html">
            
                <a href="../deployment/else/ins_mysql.html">
            
                    
                    yum安装MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.4" data-path="../deployment/else/ins_rabbitmq.html">
            
                <a href="../deployment/else/ins_rabbitmq.html">
            
                    
                    yum安装RabbitMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.5" data-path="../deployment/else/ins_redis5.html">
            
                <a href="../deployment/else/ins_redis5.html">
            
                    
                    yum安装Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.6" data-path="../deployment/else/ins_ruby_redis_dump.html">
            
                <a href="../deployment/else/ins_ruby_redis_dump.html">
            
                    
                    安装ruby和redis dump
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.7" data-path="../deployment/else/ins_yapi.html">
            
                <a href="../deployment/else/ins_yapi.html">
            
                    
                    Y-API的安装步骤
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.8" data-path="../deployment/else/gitlab-update.html">
            
                <a href="../deployment/else/gitlab-update.html">
            
                    
                    GitLab升级
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.9" data-path="../deployment/else/dataX-demo.html">
            
                <a href="../deployment/else/dataX-demo.html">
            
                    
                    dataX示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.10" data-path="../deployment/else/git-orphan-usage.html">
            
                <a href="../deployment/else/git-orphan-usage.html">
            
                    
                    git分支重置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.11" data-path="../deployment/else/repair-mysql-repl.html">
            
                <a href="../deployment/else/repair-mysql-repl.html">
            
                    
                    修复mysql主从
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.12" data-path="../deployment/else/disk-lvcreate.html">
            
                <a href="../deployment/else/disk-lvcreate.html">
            
                    
                    磁盘扩容
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.13" data-path="../deployment/else/docker-notes.html">
            
                <a href="../deployment/else/docker-notes.html">
            
                    
                    docker若干
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.14" data-path="../normal/HiS.html">
            
                <a href="../normal/HiS.html">
            
                    
                    HiS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">监控报警</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../monitoring/alerts/">
            
                <a href="../monitoring/alerts/">
            
                    
                    Alerts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../monitoring/alerts/intro_syshost_syslink.html">
            
                <a href="../monitoring/alerts/intro_syshost_syslink.html">
            
                    
                    系统监控
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../monitoring/consul/">
            
                <a href="../monitoring/consul/">
            
                    
                    Consul
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../monitoring/consul/consul.html">
            
                <a href="../monitoring/consul/consul.html">
            
                    
                    Consul
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../monitoring/consul/consul-template.html">
            
                <a href="../monitoring/consul/consul-template.html">
            
                    
                    Consul-template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../monitoring/consul/my-nginx-consul.html">
            
                <a href="../monitoring/consul/my-nginx-consul.html">
            
                    
                    Nginx-Consul-template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="../monitoring/consul/consul-acl.html">
            
                <a href="../monitoring/consul/consul-acl.html">
            
                    
                    Consul-ACL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.5" data-path="../monitoring/consul/consul-api-memo.html">
            
                <a href="../monitoring/consul/consul-api-memo.html">
            
                    
                    Consul APIs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../monitoring/prometheus/">
            
                <a href="../monitoring/prometheus/">
            
                    
                    Prometheus
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../monitoring/prometheus/prom/">
            
                <a href="../monitoring/prometheus/prom/">
            
                    
                    Prometheus
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1.1" data-path="../monitoring/prometheus/prom/prometheus-intro.html">
            
                <a href="../monitoring/prometheus/prom/prometheus-intro.html">
            
                    
                    核心组件——prometheus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.1.2" data-path="../monitoring/prometheus/prom/alertmanager.html">
            
                <a href="../monitoring/prometheus/prom/alertmanager.html">
            
                    
                    告警组件——alertmanager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.1.3" data-path="../monitoring/prometheus/prom/prometheus_federate.html">
            
                <a href="../monitoring/prometheus/prom/prometheus_federate.html">
            
                    
                    联邦
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.1.4" data-path="../monitoring/prometheus/prom/prometheus-discovery.html">
            
                <a href="../monitoring/prometheus/prom/prometheus-discovery.html">
            
                    
                    自动发现
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../monitoring/grafana/">
            
                <a href="../monitoring/grafana/">
            
                    
                    Grafana
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.2.1" data-path="../monitoring/grafana/grafana-tmpl_k8s.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_k8s.html">
            
                    
                    K8s
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2.2" data-path="../monitoring/grafana/grafana-tmpl_log.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_log.html">
            
                    
                    ELK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2.3" data-path="../monitoring/grafana/grafana-tmpl_mysql-repl.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_mysql-repl.html">
            
                    
                    MySQL-Replication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2.4" data-path="../monitoring/grafana/grafana-tmpl_pmm-mysql.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_pmm-mysql.html">
            
                    
                    PMM MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2.5" data-path="../monitoring/grafana/grafana-tmpl_rabbitmq-cluster.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_rabbitmq-cluster.html">
            
                    
                    RabbitMQ Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2.6" data-path="../monitoring/grafana/grafana-tmpl_rabbitmq.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_rabbitmq.html">
            
                    
                    RabbitMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2.7" data-path="../monitoring/grafana/grafana-tmpl_redis.html">
            
                <a href="../monitoring/grafana/grafana-tmpl_redis.html">
            
                    
                    Redis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../monitoring/prometheus/3rd/">
            
                <a href="../monitoring/prometheus/3rd/">
            
                    
                    常用软件接入Prometheus监控
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.3.1" data-path="../monitoring/prometheus/3rd/mysql-monitor-steps.html">
            
                <a href="../monitoring/prometheus/3rd/mysql-monitor-steps.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3.2" data-path="../monitoring/prometheus/3rd/Prometheus-monitor-mysql-replication.html">
            
                <a href="../monitoring/prometheus/3rd/Prometheus-monitor-mysql-replication.html">
            
                    
                    MySQL主从同步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3.3" data-path="../monitoring/prometheus/3rd/mongodb-monitor-steps.html">
            
                <a href="../monitoring/prometheus/3rd/mongodb-monitor-steps.html">
            
                    
                    MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3.4" data-path="../monitoring/prometheus/3rd/redis-monitor-steps.html">
            
                <a href="../monitoring/prometheus/3rd/redis-monitor-steps.html">
            
                    
                    Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3.5" data-path="../monitoring/prometheus/3rd/rabbitmq-monitor-steps.html">
            
                <a href="../monitoring/prometheus/3rd/rabbitmq-monitor-steps.html">
            
                    
                    RabbitMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3.6" data-path="../monitoring/prometheus/3rd/nginx-monitor-steps.html">
            
                <a href="../monitoring/prometheus/3rd/nginx-monitor-steps.html">
            
                    
                    NginX
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../monitoring/prometheus/self/prometheus-consul-guide.html">
            
                <a href="../monitoring/prometheus/self/prometheus-consul-guide.html">
            
                    
                    自研应用接入Prometheus监控
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../monitoring/zabbix/zabbix-intro.html">
            
                <a href="../monitoring/zabbix/zabbix-intro.html">
            
                    
                    Zabbix
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../monitoring/zabbix/zabbix-discovery-rule.html">
            
                <a href="../monitoring/zabbix/zabbix-discovery-rule.html">
            
                    
                    自动发现
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">日志分析</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="./">
            
                <a href="./">
            
                    
                    ELK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="es-xpack.html">
            
                <a href="es-xpack.html">
            
                    
                    X-pack权限控制版ES
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="es-account-manage.html">
            
                <a href="es-account-manage.html">
            
                    
                    ELK账号权限分组管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="elk-problems.html">
            
                <a href="elk-problems.html">
            
                    
                    ELK若干问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="clean_elk_indices.html">
            
                <a href="clean_elk_indices.html">
            
                    
                    清理ES索引
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="k8s-elk-auth-kibana-via-ad.html">
            
                <a href="k8s-elk-auth-kibana-via-ad.html">
            
                    
                    K8s部署ELK并启用AD认证
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.1.6" data-path="k8s-elk-improvement.html">
            
                <a href="k8s-elk-improvement.html">
            
                    
                    ELK部署整改
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="elk-grafana.html">
            
                <a href="elk-grafana.html">
            
                    
                    使用Grafana
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" data-path="es-api-memo.html">
            
                <a href="es-api-memo.html">
            
                    
                    ES APIs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">持续集成</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../cicd/">
            
                <a href="../cicd/">
            
                    
                    CI/CD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../cicd/gitlab/">
            
                <a href="../cicd/gitlab/">
            
                    
                    GitLab CI/CD
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../cicd/gitlab/gitlab-runner.html">
            
                <a href="../cicd/gitlab/gitlab-runner.html">
            
                    
                    GitLab Runner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../cicd/gitlab/gitlab-cicd.html">
            
                <a href="../cicd/gitlab/gitlab-cicd.html">
            
                    
                    GitLab CI/CD
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">配置管理</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../config-management/">
            
                <a href="../config-management/">
            
                    
                    CMDB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../config-management/ansible-tower.html">
            
                <a href="../config-management/ansible-tower.html">
            
                    
                    Ansible Tower
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../config-management/bk-cmdb.html">
            
                <a href="../config-management/bk-cmdb.html">
            
                    
                    BlueKing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">任务调度</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../task-scheduling/">
            
                <a href="../task-scheduling/">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../task-scheduling/xxl-job.html">
            
                <a href="../task-scheduling/xxl-job.html">
            
                    
                    XXL-JOB
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.2.1" data-path="../task-scheduling/upgrade-xxl-job.html">
            
                <a href="../task-scheduling/upgrade-xxl-job.html">
            
                    
                    XXL-JOB升级
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">关于本书</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../my-gitbook.html">
            
                <a href="../my-gitbook.html">
            
                    
                    制作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../cicd/publish-gitbook.html">
            
                <a href="../cicd/publish-gitbook.html">
            
                    
                    发布
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../HELP.html">
            
                <a href="../HELP.html">
            
                    
                    官方示例
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >ELK部署整改</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#elk-&#x6574;&#x6539;&#x4F18;&#x5316;"><b></b>ELK &#x6574;&#x6539;&#x4F18;&#x5316;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;nfs&#x53EF;&#x7528;&#x6027;"><b></b>&#x6D4B;&#x8BD5;NFS&#x53EF;&#x7528;&#x6027;</a></li><ul><li><span class="title-icon "></span><a href="#nfs&#x4F9B;&#x5E94;&#x8282;&#x70B9;"><b></b>NFS&#x4F9B;&#x5E94;&#x8282;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x6D4B;&#x8BD5;&#x8282;&#x70B9;"><b></b>&#x6D4B;&#x8BD5;&#x8282;&#x70B9;</a></li><li><span class="title-icon "></span><a href="#&#x67E5;&#x770B;&#x6570;&#x636E;&#x5E93;"><b></b>&#x67E5;&#x770B;&#x6570;&#x636E;&#x5E93;</a></li></ul><li><span class="title-icon "></span><a href="#pv&#x6570;&#x636E;&#x6062;&#x590D;&#x9A8C;&#x8BC1;"><b></b>PV&#x6570;&#x636E;&#x6062;&#x590D;&#x9A8C;&#x8BC1;</a></li><ul><li><span class="title-icon "></span><a href="#&#x6587;&#x6863;&#x5199;&#x5165;&#x3001;&#x66F4;&#x65B0;"><b></b>&#x6587;&#x6863;&#x5199;&#x5165;&#x3001;&#x66F4;&#x65B0;</a></li><li><span class="title-icon "></span><a href="#&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x91CF;"><b></b>&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x91CF;</a></li><li><span class="title-icon "></span><a href="#&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x7FA4;"><b></b>&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x7FA4;</a></li></ul><li><span class="title-icon "></span><a href="#es&#x8D26;&#x53F7;&#x8BBE;&#x7F6E;"><b></b>ES&#x8D26;&#x53F7;&#x8BBE;&#x7F6E;</a></li><ul><li><span class="title-icon "></span><a href="#&#x7528;&#x6237;&#x7EC4;&#x6743;&#x9650;&#x8BBE;&#x7F6E;"><b></b>&#x7528;&#x6237;&#x7EC4;&#x6743;&#x9650;&#x8BBE;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;"><b></b>&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;</a></li><li><span class="title-icon "></span><a href="#&#x7D22;&#x5F15;&#x540D;&#x79F0;&#x89C4;&#x8303;"><b></b>&#x7D22;&#x5F15;&#x540D;&#x79F0;&#x89C4;&#x8303;</a></li></ul><li><span class="title-icon "></span><a href="#elk&#x96C6;&#x6210;sts&#x767B;&#x5F55;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x8BB0;&#x5F55;"><b></b>ELK&#x96C6;&#x6210;STS&#x767B;&#x5F55;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x8BB0;&#x5F55;</a></li><ul><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;"><b></b>&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4FDD;&#x5BC6;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;"><b></b>&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;+&#x4FDD;&#x5BC6;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#initcontainers&#x65B9;&#x5F0F;"><b></b>initContainers&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;"><b></b>&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#poststart&#x65B9;&#x5F0F;"><b></b>postStart&#x65B9;&#x5F0F;</a></li></ul></ul></ul></div><a href="#elk-&#x6574;&#x6539;&#x4F18;&#x5316;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="elk-&#x6574;&#x6539;&#x4F18;&#x5316;"><a name="elk-&#x6574;&#x6539;&#x4F18;&#x5316;" class="anchor-navigation-ex-anchor" href="#elk-&#x6574;&#x6539;&#x4F18;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>ELK &#x6574;&#x6539;&#x4F18;&#x5316;</h1>
<blockquote>
<p>&#x4E3A;&#x4E86;&#x5C06;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x3001;&#x4EFF;&#x771F;&#x73AF;&#x5883;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;ELK&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x90E8;&#x7F72;&#x5230;K8s&#x4E2D;&#x7BA1;&#x7406;&#xFF0C;&#x4F5C;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x5C1D;&#x8BD5;&#x96C6;&#x6210;STS&#x5355;&#x70B9;&#x767B;&#x5F55;&#x3002;</p>
</blockquote>
<h2 id="&#x6D4B;&#x8BD5;nfs&#x53EF;&#x7528;&#x6027;"><a name="&#x6D4B;&#x8BD5;nfs&#x53EF;&#x7528;&#x6027;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;nfs&#x53EF;&#x7528;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;NFS&#x53EF;&#x7528;&#x6027;</h2>
<p>     <a href="k8s-elk-improvement.assets/1582856249817.png" rel="grouped" title="1582856249817" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582856249817.png" alt="1582856249817">
     </a></p>
<blockquote>
<p> &#x6D4B;&#x8BD5;&#x5E94;&#x7528;&#x4F7F;&#x7528;&#x7684;MySQL&#x6570;&#x636E;&#x76EE;&#x5F55;&#x662F;&#x901A;&#x8FC7;NFS&#x6302;&#x8F7D;&#x7684;&#xFF0C;&#x6BCF;GET&#x8BF7;&#x6C42;&#x4E00;&#x6B21; <code>http://192.168.100.157:9000/visit/add/</code> &#x4F1A;&#x65B0;&#x589E;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x5230;&#x6570;&#x636E;&#x5E93;&#x3002;&#x901A;&#x8FC7;&#x811A;&#x672C;&#x6BCF;0.01&#x79D2;&#x8BF7;&#x6C42;&#x4E00;&#x6B21;&#xFF0C;&#x5171;&#x8BF7;&#x6C42;10000&#x6B21;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF1A;&#x5F53;&#x4EBA;&#x4E3A;&#x505C;&#x6B62;NFS&#x670D;&#x52A1;&#x65F6;&#xFF0C;MySQL&#x6570;&#x636E;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x5931;&#x6548;&#xFF0C;&#x5BFC;&#x81F4;&#x8BF7;&#x6C42;&#x63A5;&#x53E3;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#xFF1B;&#x91CD;&#x65B0;&#x5F00;&#x542F;NFS&#x670D;&#x52A1;&#x540E;&#xFF0C;&#x6062;&#x590D;&#x6B63;&#x5E38;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x7EC8;&#x8BB0;&#x5F55;&#x603B;&#x6570;&#x4E00;&#x81F4;&#x3002;</p>
</blockquote>
<h3 id="nfs&#x4F9B;&#x5E94;&#x8282;&#x70B9;"><a name="nfs&#x4F9B;&#x5E94;&#x8282;&#x70B9;" class="anchor-navigation-ex-anchor" href="#nfs&#x4F9B;&#x5E94;&#x8282;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>NFS&#x4F9B;&#x5E94;&#x8282;&#x70B9;</h3>
<pre><code class="lang-sh">[root@zabbix02 elk]# cat /etc/exports
/testPV *(rw,sync)
/helloPV *(rw,no_root_squash,async)
</code></pre>
<h3 id="&#x6D4B;&#x8BD5;&#x8282;&#x70B9;"><a name="&#x6D4B;&#x8BD5;&#x8282;&#x70B9;" class="anchor-navigation-ex-anchor" href="#&#x6D4B;&#x8BD5;&#x8282;&#x70B9;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D4B;&#x8BD5;&#x8282;&#x70B9;</h3>
<pre><code class="lang-sh">[root@157-xxl-job testPV]# df -h
Filesystem                Size  Used Avail Use% Mounted on
...
192.168.100.150:/helloPV  292G   42G  250G  15% /helloPV
</code></pre>
<pre><code class="lang-yaml">db:
    image: mysql:5.7
    environment:
      TZ: &apos;Asia/Shanghai&apos;
      MYSQL_ROOT_PASSWORD: qwerasdf
      MYSQL_DATABASE: testpv
    restart: always
    command: [&apos;mysqld&apos;, &apos;--character-set-server=utf8&apos;]
    volumes:
      - &quot;/helloPV/db:/var/lib/mysql&quot;
</code></pre>
<h3 id="&#x67E5;&#x770B;&#x6570;&#x636E;&#x5E93;"><a name="&#x67E5;&#x770B;&#x6570;&#x636E;&#x5E93;" class="anchor-navigation-ex-anchor" href="#&#x67E5;&#x770B;&#x6570;&#x636E;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x67E5;&#x770B;&#x6570;&#x636E;&#x5E93;</h3>
<pre><code class="lang-sh">mysql&gt; select count(id) from visit_record;
+-----------+
| count(id) |
+-----------+
|      9999 |
+-----------+
1 row in set (0.00 sec)

mysql&gt; select * from visit_record limit 1;
+----+----------------------+----------------------------+
| id | ip_addr              | visit_date                 |
+----+----------------------+----------------------------+
|  1 | 192.168.100.157:9000 | 2020-02-28 01:13:38.370327 |
+----+----------------------+----------------------------+
1 row in set (0.00 sec)

mysql&gt; select * from visit_record order by id desc limit 1;
+------+----------------------+----------------------------+
| id   | ip_addr              | visit_date                 |
+------+----------------------+----------------------------+
| 9999 | 192.168.100.157:9000 | 2020-02-28 01:18:10.755606 |
+------+----------------------+----------------------------+
1 row in set (0.00 sec)
</code></pre>
<h2 id="pv&#x6570;&#x636E;&#x6062;&#x590D;&#x9A8C;&#x8BC1;"><a name="pv&#x6570;&#x636E;&#x6062;&#x590D;&#x9A8C;&#x8BC1;" class="anchor-navigation-ex-anchor" href="#pv&#x6570;&#x636E;&#x6062;&#x590D;&#x9A8C;&#x8BC1;"><i class="fa fa-link" aria-hidden="true"></i></a>PV&#x6570;&#x636E;&#x6062;&#x590D;&#x9A8C;&#x8BC1;</h2>
<h3 id="&#x6587;&#x6863;&#x5199;&#x5165;&#x3001;&#x66F4;&#x65B0;"><a name="&#x6587;&#x6863;&#x5199;&#x5165;&#x3001;&#x66F4;&#x65B0;" class="anchor-navigation-ex-anchor" href="#&#x6587;&#x6863;&#x5199;&#x5165;&#x3001;&#x66F4;&#x65B0;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6587;&#x6863;&#x5199;&#x5165;&#x3001;&#x66F4;&#x65B0;</h3>
<ul>
<li>&#x521D;&#x59CB;&#x5199;&#x5165;2&#x4E2A;&#x6587;&#x6863;</li>
</ul>
<pre><code class="lang-sh">curl -X PUT &quot;http://es.staging.keep.com/customer/_doc/1?pretty&quot; -H &apos;Content-Type: application/json&apos; -u elastic:elastic -d &apos;
{
  &quot;datetime&quot;: &quot;2020-02-27 10:50:00&quot;,
  &quot;name&quot;: &quot;Jim Green&quot;
}&apos;

curl -X PUT &quot;http://es.staging.keep.com/customer/_doc/2?pretty&quot; -H &apos;Content-Type: application/json&apos; -u elastic:elastic -d &apos;
{
  &quot;datetime&quot;: &quot;2020-02-27 10:51:00&quot;,
  &quot;name&quot;: &quot;Jim Green2&quot;
}
</code></pre>
<ul>
<li>&#x66F4;&#x65B0;&#x6587;&#x6863;</li>
</ul>
<pre><code class="lang-sh">curl -X PUT &quot;http://es.staging.keep.com/customer/_doc/1?pretty&quot; -H &apos;Content-Type: application/json&apos; -u elastic:elastic -d &apos;
{
  &quot;datetime&quot;: &quot;2020-02-27 10:54:00&quot;,
  &quot;name&quot;: &quot;Jim Green3&quot;
}&apos;

curl -X PUT &quot;http://es.staging.keep.com/customer/_doc/2?pretty&quot; -H &apos;Content-Type: application/json&apos; -u elastic:elastic -d &apos;
{
  &quot;datetime&quot;: &quot;2020-02-27 10:54:02&quot;,
  &quot;name&quot;: &quot;Jim Green4&quot;
}
</code></pre>
<p>     <a href="k8s-elk-improvement.assets/1582772220081.png" rel="grouped" title="1582772220081" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582772220081.png" alt="1582772220081">
     </a></p>
<ul>
<li>&#x589E;&#x52A0;2&#x4E2A;&#x6587;&#x6863;</li>
</ul>
<pre><code class="lang-sh">curl -X PUT &quot;http://es.staging.keep.com/customer/_doc/3?pretty&quot; -H &apos;Content-Type: application/json&apos; -u elastic:elastic -d &apos;
{
  &quot;datetime&quot;: &quot;2020-02-27 10:58:00&quot;,
  &quot;name&quot;: &quot;Jim Green5&quot;
}&apos;

curl -X PUT &quot;http://es.staging.keep.com/customer/_doc/4?pretty&quot; -H &apos;Content-Type: application/json&apos; -u elastic:elastic -d &apos;
{
  &quot;datetime&quot;: &quot;2020-02-27 10:58:02&quot;,
  &quot;name&quot;: &quot;Jim Green6&quot;
}&apos;
</code></pre>
<p>     <a href="k8s-elk-improvement.assets/1582772345348.png" rel="grouped" title="1582772345348" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582772345348.png" alt="1582772345348">
     </a></p>
<h3 id="&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x91CF;"><a name="&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x91CF;" class="anchor-navigation-ex-anchor" href="#&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x91CF;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x7684;&#x5BB9;&#x91CF;</h3>
<p>NFS StorageClass Provider&#x81EA;&#x52A8;&#x4E3A;ES&#x521B;&#x5EFA;&#x7684;PV&#x76EE;&#x5F55;&#x4E3A;&#xFF1A;</p>
<pre><code class="lang-sh">[root@zabbix02 ~]# ls /testPV/
yhelk-es-data-elasticsearch-0-pvc-94de2142-590a-11ea-ac5d-005056a941c1
</code></pre>
<h4 id="&#x4E0D;&#x5220;pv&#x4EC5;&#x4FEE;&#x6539;&#x7F16;&#x6392;&#x7684;&#x5BB9;&#x91CF;&#x9700;&#x6C42;"><a name="&#x4E0D;&#x5220;pv&#x4EC5;&#x4FEE;&#x6539;&#x7F16;&#x6392;&#x7684;&#x5BB9;&#x91CF;&#x9700;&#x6C42;" class="anchor-navigation-ex-anchor" href="#&#x4E0D;&#x5220;pv&#x4EC5;&#x4FEE;&#x6539;&#x7F16;&#x6392;&#x7684;&#x5BB9;&#x91CF;&#x9700;&#x6C42;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E0D;&#x5220;PV&#x4EC5;&#x4FEE;&#x6539;&#x7F16;&#x6392;&#x7684;&#x5BB9;&#x91CF;&#x9700;&#x6C42;</h4>
<pre><code class="lang-yaml">  # &#x539F;&#x5148;20Gi
  volumeClaimTemplates:
  - metadata:
      name: es-data
    spec:
      storageClassName: &quot;managed-nfs-storage&quot;
      accessModes: [ &quot;ReadWriteOnce&quot; ]
      resources:
        requests:
          storage: 40Gi
</code></pre>
<p>&#x91CD;&#x65B0;&#x90E8;&#x7F72;ES</p>
<pre><code class="lang-sh">[root@zabbix02 4cp]# kubectl apply -f es-ss.yml 
The StatefulSet &quot;elasticsearch&quot; is invalid: spec: Forbidden: updates to statefulset spec for fields other than &apos;replicas&apos;, &apos;template&apos;, and &apos;updateStrategy&apos; are forbidden
</code></pre>
<p>&#x56E0;&#x4E3A;&#x662F;statefulset.apps&#xFF0C;&#x63D0;&#x793A;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;apply&#xFF0C;&#x5148;delete&#x518D;apply</p>
<pre><code class="lang-sh">[root@zabbix02 4cp]# kubectl delete -f es-ss.yml 
statefulset.apps &quot;elasticsearch&quot; deleted
[root@zabbix02 4cp]# kubectl apply -f es-ss.yml 
statefulset.apps/elasticsearch created
</code></pre>
<p>PV&#x76EE;&#x5F55;&#x672A;&#x53D8;&#x5316;&#xFF0C;&#x5E76;&#x4E14;&#x4ECE;Kibana&#x67E5;&#x770B;&#x6570;&#x636E;&#x8FD8;&#x662F;&#x5BB9;&#x91CF;&#x53D8;&#x66F4;&#x524D;&#x7684;&#x6837;&#x5B50;</p>
<p>     <a href="k8s-elk-improvement.assets/1582773231870.png" rel="grouped" title="1582773231870" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582773231870.png" alt="1582773231870">
     </a></p>
<p>&#x8BF4;&#x660E;&#x4E0D;&#x5220;&#x9664;&#x5DF2;&#x521B;&#x5EFA;&#x7684;PV&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4FEE;&#x6539;&#x8BF7;&#x6C42;PV&#x5BB9;&#x91CF;&#x503C;<code>resources.requests.storage</code>&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x5DF2;&#x6709;&#x6570;&#x636E;&#x3002;</p>
<h4 id="&#x5220;pv&#x91CD;&#x5EFA;es"><a name="&#x5220;pv&#x91CD;&#x5EFA;es" class="anchor-navigation-ex-anchor" href="#&#x5220;pv&#x91CD;&#x5EFA;es"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5220;PV&#x91CD;&#x5EFA;ES</h4>
<pre><code class="lang-sh">[root@zabbix02 4cp]# sh run-es.sh down
ingress.extensions &quot;elasticsearch&quot; deleted
service &quot;elasticsearch&quot; deleted
statefulset.apps &quot;elasticsearch&quot; deleted
configmap &quot;es-config&quot; deleted
secret &quot;rp-client-secret&quot; deleted
[root@zabbix02 4cp]# kubectl delete pvc -n yhelk es-data-elasticsearch-0
persistentvolumeclaim &quot;es-data-elasticsearch-0&quot; deleted

[root@zabbix02 4cp]# sh run-es.sh
namespace/yhelk unchanged
secret/rp-client-secret created
configmap/es-config created
statefulset.apps/elasticsearch created
service/elasticsearch created
ingress.extensions/elasticsearch created
</code></pre>
<p>     <a href="k8s-elk-improvement.assets/1582774172498.png" rel="grouped" title="1582774172498" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582774172498.png" alt="1582774172498">
     </a></p>
<p>&#x5220;&#x9664;PV&#x540E;&#xFF0C;PV&#x76EE;&#x5F55;&#x88AB;&#x5F52;&#x6863;</p>
<pre><code class="lang-sh">[root@zabbix02 4cp]# ls /testPV/
archived-yhelk-es-data-elasticsearch-0-pvc-94de2142-590a-11ea-ac5d-005056a941c1
</code></pre>
<p>&#x91CD;&#x5EFA;&#x540E;&#xFF0C;&#x751F;&#x6210;&#x4E86;&#x65B0;&#x7684;PV&#x76EE;&#x5F55;</p>
<pre><code class="lang-sh">[root@zabbix02 4cp]# ls /testPV/
archived-yhelk-es-data-elasticsearch-0-pvc-94de2142-590a-11ea-ac5d-005056a941c1
yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1
</code></pre>
<p>&#x663E;&#x7136;&#xFF0C;&#x4E4B;&#x524D;&#x7684;&#x4FDD;&#x5B58;&#x7684;&#x6587;&#x6863;&#x4E0D;&#x5728;&#x65B0;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x67E5;&#x770B;Kibana&#x4E5F;&#x663E;&#x793A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7D22;&#x5F15;&#xFF1A;</p>
<p>     <a href="k8s-elk-improvement.assets/1582774922290.png" rel="grouped" title="1582774922290" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582774922290.png" alt="1582774922290">
     </a></p>
<p>&#x5C1D;&#x8BD5;&#x6062;&#x590D;&#x65E7;&#x6570;&#x636E;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x901A;&#x8FC7;&#x79FB;&#x52A8;&#x5F52;&#x6863;&#x7684;PV&#x76EE;&#x5F55;&#x66FF;&#x6362;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x7684;PV&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x5220;&#x9664;es&#x7684;pod&#x4EE5;&#x4F7F;&#x5176;&#x88AB;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#xFF1A;</p>
<pre><code class="lang-sh">[root@zabbix02 4cp]# mv /testPV/yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1/ /testPV/yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1.old
[root@zabbix02 4cp]# ls /testPV/
archived-yhelk-es-data-elasticsearch-0-pvc-94de2142-590a-11ea-ac5d-005056a941c1
yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1.old
[root@zabbix02 4cp]# mv /testPV/archived-yhelk-es-data-elasticsearch-0-pvc-94de2142-590a-11ea-ac5d-005056a941c1/ /testPV/yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1
[root@zabbix02 4cp]# ls /testPV/
yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1
yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1.old
[root@zabbix02 4cp]# kubectl get pod -n yhelk
NAME                      READY   STATUS    RESTARTS   AGE
elasticsearch-0           1/1     Running   0          7m17s
kibana-6564b7c688-bvmf4   1/1     Running   0          61m
[root@zabbix02 4cp]# kubectl delete pod -n yhelk elasticsearch-0 
pod &quot;elasticsearch-0&quot; deleted
[root@zabbix02 4cp]# kubectl get pod -n yhelk
NAME                      READY   STATUS    RESTARTS   AGE
elasticsearch-0           1/1     Running   0          16s
kibana-6564b7c688-bvmf4   1/1     Running   0          62m
</code></pre>
<p>&#x5F85;kibana&#x91CD;&#x65B0;&#x8FDE;&#x63A5;es&#x540E;&#xFF0C;&#x663E;&#x793A;&#x65E7;&#x6587;&#x6863;&#x5DF2;&#x6062;&#x590D;&#xFF1A;</p>
<p>     <a href="k8s-elk-improvement.assets/1582775406309.png" rel="grouped" title="1582775406309" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582775406309.png" alt="1582775406309">
     </a></p>
<hr>
<h3 id="&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x7FA4;"><a name="&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x7FA4;" class="anchor-navigation-ex-anchor" href="#&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x7FA4;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6570;&#x636E;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x7FA4;</h3>
<h4 id="&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;elk&#x73AF;&#x5883;"><a name="&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;elk&#x73AF;&#x5883;" class="anchor-navigation-ex-anchor" href="#&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;elk&#x73AF;&#x5883;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;ELK&#x73AF;&#x5883;</h4>
<p>&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x7A7A;&#x95F4; yhelk2 &#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ELK&#x73AF;&#x5883;&#xFF1A;</p>
<p>&#x5BF9;&#x5E94;&#x7684;PV&#x76EE;&#x5F55;&#xFF1A;</p>
<p>     <a href="k8s-elk-improvement.assets/1582785238406.png" rel="grouped" title="1582785238406" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582785238406.png" alt="1582785238406">
     </a></p>
<h4 id="&#x590D;&#x5236;&#x8FC1;&#x79FB;&#x6570;&#x636E;"><a name="&#x590D;&#x5236;&#x8FC1;&#x79FB;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#&#x590D;&#x5236;&#x8FC1;&#x79FB;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x590D;&#x5236;&#x8FC1;&#x79FB;&#x6570;&#x636E;</h4>
<p>&#x5148;&#x5220;&#x9664;&#x521A;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x7684;ES&#xFF0C;&#x4EC5;&#x4FDD;&#x7559;PVC&#x548C;PV&#x3002;&#x5982;&#x679C;&#x5220;&#x9664;PVC&#xFF08;&#x548C;PV&#xFF09;&#xFF0C;&#x539F;&#x6570;&#x636E;&#xFF08;&#x76EE;&#x5F55;&#xFF09;&#x4F1A;&#x88AB;&#x5F52;&#x6863;&#xFF0C;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x540E;&#x4F1A;&#x91CD;&#x5EFA;PV&#x3002;</p>
<p>     <a href="k8s-elk-improvement.assets/1582786894380.png" rel="grouped" title="1582786894380" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582786894380.png" alt="1582786894380">
     </a></p>
<p>&#x518D;&#x5C06;&#x5BF9;&#x5E94;yhelk&#x7A7A;&#x95F4;&#x7684;&#x539F;&#x6709;ELK&#x73AF;&#x5883;&#x7684;PV&#x76EE;&#x5F55;&#x590D;&#x5236;&#x4E00;&#x4EFD;&#x66FF;&#x6362;&#x65B0;ELK&#x73AF;&#x5883;&#x7684;PV&#x76EE;&#x5F55;</p>
<pre><code class="lang-sh">mv /testPV/yhelk2-es-data-elasticsearch-0-pvc-a2488669-5929-11ea-ac5d-005056a941c1{,.old}

cp -rp /testPV/yhelk-es-data-elasticsearch-0-pvc-cb8ea87c-5912-11ea-ac5d-005056a941c1  /testPV/yhelk2-es-data-elasticsearch-0-pvc-a2488669-5929-11ea-ac5d-005056a941c1
</code></pre>
<p>     <a href="k8s-elk-improvement.assets/1582786693455.png" rel="grouped" title="1582786693455" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582786693455.png" alt="1582786693455">
     </a></p>
<p>&#x91CD;&#x5EFA;yhelk2&#x7A7A;&#x95F4;&#x7684;ES&#xFF0C;&#x56E0;&#x5BF9;&#x5E94;&#x7684;PV&#x76EE;&#x5F55;&#x540D;&#x79F0;&#x4E0D;&#x53D8;&#xFF0C;&#x5C06;&#x4F1A;&#x52A0;&#x8F7D;&#x8BE5;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;&#x5728;Kibana&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x65B0;&#x3001;&#x65E7;&#x73AF;&#x5883;ELK&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3001;&#x6587;&#x6863;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF1A;</p>
<p>     <a href="k8s-elk-improvement.assets/1582787118597.png" rel="grouped" title="1582787118597" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582787118597.png" alt="1582787118597">
     </a></p>
<blockquote>
<p>&#x8FD9;&#x8BF4;&#x660E;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x7684;ELK&#x96C6;&#x7FA4;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x590D;&#x5236;&#x6570;&#x636E;&#x76EE;&#x5F55;&#x7684;&#x65B9;&#x5F0F;&#x4ECE;&#x4E00;&#x4E2A;&#x73AF;&#x5883;&#x8FC1;&#x79FB;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x3002;&#x53EF;&#x4EE5;&#x4F5C;&#x51FA;&#x5408;&#x7406;&#x63A8;&#x6D4B;&#xFF1A;1. &#x5982;&#x679C;&#x4E24;&#x4E2A;ES&#x96C6;&#x7FA4;&#x7684;&#x8282;&#x70B9;&#x6570;&#x4E00;&#x6837;&#xFF08;&#x5BF9;&#x5E94;&#x7684;PV&#x76EE;&#x5F55;&#x6570;&#x4E00;&#x6837;&#xFF09;&#xFF0C;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x590D;&#x5236;&#x7684;&#x65B9;&#x5F0F;&#x8FC1;&#x79FB;&#x3002;2. ES&#x5BF9;&#x4F9B;&#x5E94;PV&#x7684;NFS&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x65E0;&#x611F;&#x77E5;&#x7684;&#xFF0C;NFS&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x81EA;&#x8EAB;&#x6269;&#x5BB9;&#x3001;&#x7F29;&#x5BB9;&#xFF0C;&#x53EA;&#x8981;&#x6EE1;&#x8DB3;pod&#x9700;&#x6C42;&#xFF0C;&#x6570;&#x636E;&#x5C31;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x3002;</p>
</blockquote>
<hr>
<h2 id="es&#x8D26;&#x53F7;&#x8BBE;&#x7F6E;"><a name="es&#x8D26;&#x53F7;&#x8BBE;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#es&#x8D26;&#x53F7;&#x8BBE;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>ES&#x8D26;&#x53F7;&#x8BBE;&#x7F6E;</h2>
<p>&#x542F;&#x7528;&#x4E86;AD&#x8BA4;&#x8BC1;&#x540E;&#xFF0C;&#x9664;&#x4E86;&#x51E0;&#x4E2A;&#x5185;&#x7F6E;&#x7684;&#x7528;&#x6237;&#x548C;&#x5DF2;&#x6388;&#x6743;&#x7684;AD&#x8D26;&#x53F7;&#x5916;&#xFF0C;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x7528;&#x6237;&#xFF08;&#x672A;&#x88AB;AD&#x7BA1;&#x7406;&#x7684;&#xFF09;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF1A;</p>
<pre><code class="lang-sh">{
  &quot;error&quot; : {
    &quot;root_cause&quot; : [
      {
        &quot;type&quot; : &quot;security_exception&quot;,
        &quot;reason&quot; : &quot;unable to authenticate user [etms_dev] for REST request [/dev.etms.abc/_doc/1?pretty]&quot;,
        &quot;header&quot; : {
          &quot;WWW-Authenticate&quot; : &quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;
        }
      }
    ],
    &quot;type&quot; : &quot;security_exception&quot;,
    &quot;reason&quot; : &quot;unable to authenticate user [etms_dev] for REST request [/dev.etms.abc/_doc/1?pretty]&quot;,
    &quot;header&quot; : {
      &quot;WWW-Authenticate&quot; : &quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;
    }
  },
  &quot;status&quot; : 401
}
</code></pre>
<h3 id="&#x7528;&#x6237;&#x7EC4;&#x6743;&#x9650;&#x8BBE;&#x7F6E;"><a name="&#x7528;&#x6237;&#x7EC4;&#x6743;&#x9650;&#x8BBE;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x7528;&#x6237;&#x7EC4;&#x6743;&#x9650;&#x8BBE;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7528;&#x6237;&#x7EC4;&#x6743;&#x9650;&#x8BBE;&#x7F6E;</h3>
<p>&#x53EA;&#x80FD;&#x8BBE;&#x7F6E;&#x4E24;&#x7C7B;&#x6743;&#x9650;</p>
<pre><code class="lang-sh">PUT /_security/role_mapping/admins
{
  &quot;roles&quot; : [ &quot;superuser&quot; ],
  &quot;rules&quot; : {
    &quot;field&quot; : {
      &quot;groups&quot; : &quot;CN=elk_admin,OU=Elasticsearch,OU=&#x7CFB;&#x7EDF;&#x5E10;&#x53F7;,DC=keep,DC=com&quot;
    }
  },
  &quot;enabled&quot;: true
}

PUT  /_security/role_mapping/basic_users
{
    &quot;enabled&quot; : true,
    &quot;roles&quot; : [
      &quot;kibana_user&quot;
    ],
    &quot;rules&quot; : {
      &quot;any&quot; : [
        {
          &quot;field&quot; : {
            &quot;groups&quot; : &quot;CN=elk_user,OU=Elasticsearch,OU=&#x7CFB;&#x7EDF;&#x5E10;&#x53F7;,DC=keep,DC=com&quot;
          }
        }
      ]
    },
    &quot;metadata&quot; : { }
}
</code></pre>
<h3 id="&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;"><a name="&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;" class="anchor-navigation-ex-anchor" href="#&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;</h3>
<blockquote>
<p>&#x521A;&#x5F00;&#x59CB;&#x6240;&#x6709;&#x7528;&#x6237;&#x8981;&#x4E48;&#x5C5E;&#x4E8E;elk_admin&#x7EC4;&#xFF0C;&#x8981;&#x4E48;&#x5C5E;&#x4E8E;elk_user&#x7EC4;&#xFF0C;&#x5E76;&#x5177;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x4E24;&#x7C7B;&#x6743;&#x9650;&#x3002;&#x5982;&#x679C;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x5355;&#x72EC;&#x8BBE;&#x7F6E;&#x7EC4;&#x5185;&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x53EF;&#x6309;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x8FDB;&#x884C;&#xFF1A;</p>
</blockquote>
<ul>
<li>&#x5148;&#x6309;&#x4F20;&#x7EDF;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6240;&#x9700;&#x6743;&#x9650;&#x7684;&#x89D2;&#x8272;</li>
<li>&#x5728;kibana&#x624B;&#x52A8;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0E;AD&#x8D26;&#x53F7;&#x540C;&#x540D;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x5BC6;&#x7801;&#x968F;&#x610F;&#x8BBE;&#x7F6E;&#xFF0C;&#x5E76;&#x4E0E;&#x521A;&#x521A;&#x521B;&#x5EFA;&#x7684;&#x89D2;&#x8272;&#x7ED1;&#x5B9A;</li>
<li>&#x4EE5;&#x8BE5;&#x7528;&#x6237;&#x540D;&#x53CA;&#x76F8;&#x5E94;&#x7684;AD&#x5BC6;&#x7801;&#x767B;&#x5F55;Kibana&#x5373;&#x53EF;&#x53D1;&#x73B0;&#x6743;&#x9650;&#x5DF2;&#x53D8;&#x66F4;</li>
</ul>
<pre><code class="lang-sh"># &#x67E5;&#x770B;&#x3001;&#x5220;&#x9664;admins&#x7684;role_mapping
GET /_security/role_mapping/admins
DELETE /_security/role_mapping/admins

# &#x67E5;&#x770B;&#x3001;&#x5220;&#x9664;basic_users&#x7684;role_mapping
GET /_security/role_mapping/basic_users
DELETE /_security/role_mapping/basic_users

PUT /_security/role_mapping/admins
{
  &quot;roles&quot; : [ &quot;superuser&quot; ],
  &quot;rules&quot; : {
    &quot;field&quot; : {
      &quot;groups&quot; : &quot;CN=elk_admin,OU=Elasticsearch,OU=&#x7CFB;&#x7EDF;&#x5E10;&#x53F7;,DC=keep,DC=com&quot;
    }
  },
  &quot;enabled&quot;: true
}

PUT  /_security/role_mapping/basic_users
{
    &quot;enabled&quot; : true,
    &quot;roles&quot; : [
      &quot;kibana_user&quot;
    ],
    &quot;rules&quot; : {
      &quot;any&quot; : [
        {
          &quot;field&quot; : {
            &quot;groups&quot; : &quot;CN=elk_user,OU=Elasticsearch,OU=&#x7CFB;&#x7EDF;&#x5E10;&#x53F7;,DC=keep,DC=com&quot;
          }
        }
      ]
    },
    &quot;metadata&quot; : { }
}
</code></pre>
<h3 id="&#x7D22;&#x5F15;&#x540D;&#x79F0;&#x89C4;&#x8303;"><a name="&#x7D22;&#x5F15;&#x540D;&#x79F0;&#x89C4;&#x8303;" class="anchor-navigation-ex-anchor" href="#&#x7D22;&#x5F15;&#x540D;&#x79F0;&#x89C4;&#x8303;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7D22;&#x5F15;&#x540D;&#x79F0;&#x89C4;&#x8303;</h3>
<p><strong>&#x5EFA;&#x8BAE;&#x6309;</strong></p>
<p><code>&lt;&#x73AF;&#x5883;&#x540D;&#x79F0;&gt;.&lt;&#x7CFB;&#x7EDF;&gt;[.&lt;&#x5E94;&#x7528;&gt;][.&lt;&#x65E5;&#x5FD7;&#x7C7B;&#x578B;&gt;]_&lt;YYYY.MM.dd&gt;</code></p>
<p>&#x7684;&#x5F62;&#x5F0F;&#x53D6;&#x7D22;&#x5F15;&#x540D;&#x79F0;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<p><code>dev.etms.webhost.error-log_2020.02.28</code></p>
<p>&#x636E;&#x4EE5;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x9488;&#x5BF9; &#x9879;&#x76EE;&#x7EC4;&#x53CA;&#x4E2A;&#x4EBA;&#x8BBE;&#x7F6E;ELK&#x6743;&#x9650;&#x3002;&#x6BD4;&#x5982;&#x8BBE;&#x7F6E;ETMS&#x7EC4;&#x6210;&#x5458;dev&#x73AF;&#x5883;&#x7684;&#x6743;&#x9650;&#xFF1A;</p>
<ol>
<li>&#x521B;&#x5EFA;&#x89D2;&#x8272;<code>role_etms_dev</code></li>
</ol>
<pre><code class="lang-sh">PUT /_security/role/role_etms_dev
{
    &quot;cluster&quot; : [ ],
    &quot;indices&quot; : [
      {
        &quot;names&quot; : [
          &quot;dev.etms.*&quot;
        ],
        &quot;privileges&quot; : [
          &quot;all&quot;
        ],
        &quot;field_security&quot; : {
          &quot;grant&quot; : [
            &quot;*&quot;
          ],
          &quot;except&quot; : [ ]
        },
        &quot;allow_restricted_indices&quot; : false
      }
    ],
    &quot;applications&quot; : [
      {
        &quot;application&quot; : &quot;kibana-.kibana&quot;,
        &quot;privileges&quot; : [
          &quot;feature_discover.all&quot;,
          &quot;feature_visualize.all&quot;,
          &quot;feature_dashboard.all&quot;,
          &quot;feature_dev_tools.all&quot;,
          &quot;feature_indexPatterns.all&quot;
        ],
        &quot;resources&quot; : [
          &quot;space:default&quot;
        ]
      }
    ],
    &quot;run_as&quot; : [ ],
    &quot;metadata&quot; : { },
    &quot;transient_metadata&quot; : {
      &quot;enabled&quot; : true
    }
}
</code></pre>
<ol>
<li>&#x521B;&#x5EFA;etms&#x7EC4;&#x6210;&#x5458;AD&#x8D26;&#x53F7;&#x540C;&#x540D;&#x7684;ES&#x8D26;&#x53F7;&#x5E76;&#x7ED1;&#x5B9A;&#x89D2;&#x8272;</li>
</ol>
<p>     <a href="k8s-elk-improvement.assets/1582881482944.png" rel="grouped" title="1582881482944" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582881482944.png" alt="1582881482944">
     </a></p>
<ol>
<li>&#x767B;&#x5F55;&#x67E5;&#x770B;&#x6548;&#x679C;</li>
</ol>
<p>     <a href="k8s-elk-improvement.assets/1582881659083.png" rel="grouped" title="1582881659083" target="_self" class="fancybox">
       <img src="k8s-elk-improvement.assets/1582881659083.png" alt="1582881659083">
     </a></p>
<hr>
<h2 id="elk&#x96C6;&#x6210;sts&#x767B;&#x5F55;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x8BB0;&#x5F55;"><a name="elk&#x96C6;&#x6210;sts&#x767B;&#x5F55;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x8BB0;&#x5F55;" class="anchor-navigation-ex-anchor" href="#elk&#x96C6;&#x6210;sts&#x767B;&#x5F55;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x8BB0;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>ELK&#x96C6;&#x6210;STS&#x767B;&#x5F55;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x8BB0;&#x5F55;</h2>
<blockquote>
<p>&#x56E0;&#x4E3A;ES&#x4E0D;&#x652F;&#x6301;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x76F4;&#x63A5;&#x914D;&#x7F6E;&#xFF1A;rp.client_secret &#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x5B83;&#x4E00;&#x4E9B;&#x96C6;&#x6210;OpenID&#x7684;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x4E0D;&#x6E05;&#x6670;&#xFF0C;&#x4F5C;&#x4E86;&#x5982;&#x4E0B;&#x5927;&#x91CF;&#x5C1D;&#x8BD5;&#xFF1A;</p>
</blockquote>
<h3 id="&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;"><a name="&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;</h3>
<p>OIDC realm&#x914D;&#x7F6E;&#x5230;es-cm.yml</p>
<pre><code class="lang-yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: es-config
  namespace: elk
  labels:
    k8s-app: elasticsearch
data:
  #role_mapping.yml: |-
  #  kibana_user:
  #    - &quot;CN=elk_user,OU=&#x7CFB;&#x7EDF;&#x5E10;&#x53F7;,DC=keep,DC=com&quot;
  #    - &quot;CN=&#x5821;&#x5792;&#x673A;,CN=Users,DC=keep,DC=com&quot;
  #  superuser:
  #    - &quot;CN=elk_admin,OU=&#x7CFB;&#x7EDF;&#x5E10;&#x53F7;,DC=keep,DC=com&quot;

  elasticsearch.yml: |-
    cluster.name: &quot;docker-cluster&quot;
    network.host: 0.0.0.0
    discovery.zen.minimum_master_nodes: 1
    discovery.type: single-node
    xpack.security.authc.realms.active_directory:
      my_ad:
        order: 0
        domain_name: keep.com
        url: ldap://192.168.100.120:389, ldap://192.168.100.129:389
        bind_dn: xxx@keep.com
        bind_password: ******
        load_balance:
          type: &quot;round_robin&quot;
        user_search:
          base_dn: &quot;dc=keep,dc=com&quot;
          filter: &quot;(&amp;(objectClass=user)(sAMAccountName={0}))&quot;
        group_search:
          base_dn: &quot;dc=keep,dc=com&quot;
        #files:
        #  role_mapping: &quot;/usr/share/elasticsearch/config/role_mapping.yml&quot;
        #unmapped_groups_as_roles: true
    xpack.security.authc.realms.oidc.oidc1:
      order: 2
      rp.client_id: &quot;kibana&quot;
      # rp.client_secret: &quot;secret&quot;  # rp.client_secret &#x4E0D;&#x80FD;&#x8FD9;&#x6837;&#x5199;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x6709;&#x4E0B;&#x9762;&#x62A5;&#x9519;&#x4FE1;&#x606F;
      rp.response_type: code
      rp.requested_scopes: [openid,profile]
      rp.redirect_uri: &quot;http://kibana.staging.keep.com/api/security/v1/oidc&quot;
      rp.post_logout_redirect_uri: &quot;http://kibana.staging.keep.com/logged_out&quot;
      op.issuer: &quot;https://sts.keep.cn&quot;
      op.authorization_endpoint: &quot;http://sts.staging.keep.com/connect/authorize&quot;
      op.token_endpoint: &quot;http://sts.staging.keep.com/connect/token&quot;
      #op.userinfo_endpoint: &quot;http://sts.staging.keep.com/connect/userinfo&quot;
      #op.end_session_endpoint: &quot;http://sts.staging.keep.com/connect/endsession&quot;
      claims.principal: email_verified
      claim_patterns.principal: &quot;^([^@]+)@keep\\.com$&quot;
</code></pre>
<p>kb-cm.yml</p>
<pre><code class="lang-yaml">xpack.security.authc.providers: [oidc, basic]
xpack.security.authc.oidc.realm: &quot;oidc1&quot;
server.xsrf.whitelist: [/api/security/v1/oidc, /logged_out]
</code></pre>
<p>&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>&quot;Caused by: java.lang.IllegalArgumentException: unknown setting [xpack.security.authc.realms.oidc.oidc1.op.end_session_endpoint] please check that any required plugins are installed, or check the breaking changes documentation for removed settings&quot;,
...

[xpack.security.authc.realms.oidc.oidc1.rp.client_secret] is a secure setting and must be stored inside the Elasticsearch keystore, but was found inside elasticsearch.yml&quot;,
...
</code></pre><p>&#x9047;&#x5230;&#x7684;&#x5F02;&#x5E38;&#x4E3B;&#x8981;&#x6709;&#xFF1A;</p>
<ul>
<li><p>[xpack.security.authc.realms.oidc.oidc1.op.end_session_endpoint] please check that any required plugins are installed, or check the breaking changes documentation for removed settings&quot;</p>
</li>
<li><p>Setting [xpack.security.authc.realms.oidc.oidc1.rp.client_secret] is a secure setting and must be stored inside the Elasticsearch keystore, but was found inside elasticsearch.yml</p>
</li>
<li><p>java.lang.IllegalStateException: security initialization failed&quot;</p>
<p>The configuration setting [xpack.security.authc.realms.oidc.oidc1.rp.client_secret] is required&quot;</p>
</li>
</ul>
<h3 id="&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4FDD;&#x5BC6;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;"><a name="&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4FDD;&#x5BC6;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4FDD;&#x5BC6;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;+&#x4FDD;&#x5BC6;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x5F0F;</h3>
<pre><code class="lang-yaml">apiVersion: v1
kind: Secret
metadata:
  name: rp-client-secret
type: Opaque
data:
  xpack.security.authc.realms.oidc.oidc1.rp.client_secret: c2VjcmV0Cg==
</code></pre>
<pre><code class="lang-yaml">        env:
          - name: &quot;xpack.security.authc.realms.oidc.oidc1.rp.client_secret&quot;
            valueFrom:
              secretKeyRef:
                name: rp-client-secret
                key: xpack.security.authc.realms.oidc.oidc1.rp.client_secret
</code></pre>
<p>&#x62A5;&#x9519;&#x540C;&#x4E0A;&#xFF0C;&#x5931;&#x8D25;</p>
<h3 id="initcontainers&#x65B9;&#x5F0F;"><a name="initcontainers&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#initcontainers&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>initContainers&#x65B9;&#x5F0F;</h3>
<pre><code class="lang-yaml">    spec:
      initContainers:
      - image: lzzeng/es-xpack:7.5.1
        name: inites
        command:
          - sh
          - -c
          - |                
            echo -e &quot;y\nsecret&quot; | /usr/share/elasticsearch/bin/elasticsearch-keystore add --stdin xpack.security.authc.realms.oidc.oidc1.rp.client_secret
            exit 0
        volumeMounts:
        - name: config
          subPath: elasticsearch.keystore
          mountPath: /usr/share/elasticsearch/config/elasticsearch.keystore
</code></pre>
<p>&#x4F01;&#x56FE;&#x901A;&#x8FC7;initContainer&#x4E0E;es&#x5171;&#x4EAB;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;rp.client_secret&#xFF0C;initContainer&#x6B63;&#x5E38;&#x521D;&#x59CB;&#x5316;&#x540E;&#xFF0C;es pod&#x5F02;&#x5E38;&#x9000;&#x51FA;&#xFF0C;&#x4E3B;&#x8981;&#x9519;&#x8BEF;&#x539F;&#x56E0;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-sh">[root@zabbix02 4cp-err]# kubectl logs -f -n yhelk elasticsearch-0 
Exception in thread &quot;main&quot; java.lang.IllegalStateException: unable to read from standard input; is standard input open and a tty attached?
    at org.elasticsearch.cli.Terminal$SystemTerminal.readText(Terminal.java:207)
    at org.elasticsearch.cli.Terminal.promptYesNo(Terminal.java:140)
    at org.elasticsearch.common.settings.CreateKeyStoreCommand.execute(CreateKeyStoreCommand.java:43)
    at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)
    at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)
    at org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:77)
    at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)
    at org.elasticsearch.cli.Command.main(Command.java:90)
    at org.elasticsearch.common.settings.KeyStoreCli.main(KeyStoreCli.java:41)
</code></pre>
<p>&#x5931;&#x8D25;</p>
<h3 id="&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;"><a name="&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;</h3>
<p>&#x76F4;&#x63A5;&#x4FEE;&#x6539;es&#x955C;&#x50CF;&#xFF0C;&#x5728;&#x955C;&#x50CF;&#x4E2D;&#x751F;&#x6210;elasticsearch.keystore&#xFF0C;&#x5E76;&#x5B8C;&#x6210;&#x5176;&#x5B83;&#x914D;&#x7F6E;&#x3002;</p>
<pre><code class="lang-yaml">FROM lzzeng/es-xpack:7.5.1

ENV RP_CLIENT_SECRET secret

ADD elasticsearch.yml /usr/share/elasticsearch/config/
RUN echo -e &quot;y\n${RP_CLIENT_SECRET}&quot; | /usr/share/elasticsearch/bin/elasticsearch-keystore add --stdin xpack.security.authc.realms.oidc.oidc1.rp.client_secret; /usr/share/elasticsearch/bin/elasticsearch-keystore list &gt; /opt/elasticsearch.keystore
</code></pre>
<p>elasticsearch.yml:</p>
<pre><code class="lang-yaml">cluster.name: &quot;docker-cluster&quot;
network.host: 0.0.0.0
discovery.zen.minimum_master_nodes: 1
discovery.type: single-node
xpack.security.authc.realms.active_directory:
  my_ad:
    order: 0
    domain_name: keep.com
    url: ldap://192.168.100.120:389, ldap://192.168.100.129:389
    bind_dn: xxx@keep.com
    bind_password: xxxxxx
    load_balance:
      type: &quot;round_robin&quot;
    user_search:
      base_dn: &quot;dc=keep,dc=com&quot;
      filter: &quot;(&amp;(objectClass=user)(sAMAccountName={0}))&quot;
    group_search:
      base_dn: &quot;dc=keep,dc=com&quot;
    #files:
    #  role_mapping: &quot;/usr/share/elasticsearch/config/role_mapping.yml&quot;
    #unmapped_groups_as_roles: true
xpack.security.authc.realms.oidc.oidc1:
  order: 2
  rp.client_id: &quot;kibana&quot;
  rp.response_type: code
  rp.requested_scopes: [openid, profile]
  rp.redirect_uri: &quot;http://kibana.staging.keep.com/api/security/v1/oidc&quot;
  op.issuer: &quot;https://sts.keep.cn&quot;
  op.authorization_endpoint: &quot;http://sts.staging.keep.com/connect/authorize&quot;
  op.token_endpoint: &quot;http://sts.staging.keep.com/connect/token&quot;
  claims.principal: email_verified
  claim_patterns.principal: &quot;^([^@]+)@keep\\.com$&quot;
</code></pre>
<p>&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#xFF0C;&#x62A5;&#x9519;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-sh">&quot;Caused by: org.elasticsearch.common.settings.SettingsException: found settings for the realm [oidc1] (with type [oidc]) in the secure settings (elasticsearch.keystore), but this realm does not have any settings in elasticsearch.yml. Please remove these settings from the keystore, or update their names to match one of the realms that are defined in elasticsearch.yml - [xpack.security.authc.realms.oidc.oidc1.rp.client_secret]&quot;,
</code></pre>
<p>&#x5931;&#x8D25;</p>
<h3 id="poststart&#x65B9;&#x5F0F;"><a name="poststart&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#poststart&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>postStart&#x65B9;&#x5F0F;</h3>
<pre><code class="lang-yaml">    containers:
      - image:
        ...

        lifecycle:
          postStart:
            exec:
              command:
                - sh
                - -c
                - |
                  rm -f /usr/share/elasticsearch/config/elasticsearch.keystore*
                  echo -e &quot;y\nsecret&quot; | /usr/share/elasticsearch/bin/elasticsearch-keystore add --stdin xpack.security.authc.realms.oidc.oidc1.rp.client_secret
                  exit 0
</code></pre>
<p>&#x518D;&#x53CD;&#x590D;&#x6839;&#x636E;&#x9519;&#x8BEF;&#x63D0;&#x793A;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x5B57;&#x5178;&#xFF0C;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x6709;&#xFF1A;</p>
<pre><code class="lang-sh">&quot;Caused by: org.elasticsearch.common.settings.SettingsException: The configuration setting [xpack.security.authc.realms.oidc.oidc1.op.jwkset_path] is required&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.require(OpenIdConnectRealm.java:329) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.buildOpenIdConnectProviderConfiguration(OpenIdConnectRealm.java:283) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.&lt;init&gt;(OpenIdConnectRealm.java:105) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.InternalRealms.lambda$getFactories$7(InternalRealms.java:119) ~[?:?]&quot;,
</code></pre>
<pre><code class="lang-sh">&quot;Caused by: org.elasticsearch.common.settings.SettingsException: The configuration setting [xpack.security.authc.realms.oidc.oidc1.rp.client_secret] is required&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.buildRelyingPartyConfiguration(OpenIdConnectRealm.java:259) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.&lt;init&gt;(OpenIdConnectRealm.java:104) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.InternalRealms.lambda$getFactories$7(InternalRealms.java:119) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.Realms.initRealms(Realms.java:218) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.Realms.&lt;init&gt;(Realms.java:72) ~[?:?]&quot;,
</code></pre>
<pre><code class="lang-sh">&quot;Caused by: java.lang.IllegalStateException: OpenID Connect Realm requires that the token service be enabled (xpack.security.authc.token.enabled)&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.&lt;init&gt;(OpenIdConnectRealm.java:114) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.InternalRealms.lambda$getFactories$7(InternalRealms.java:119) ~[?:?]&quot;,
</code></pre>
<pre><code class="lang-sh">{&quot;type&quot;: &quot;server&quot;, &quot;timestamp&quot;: &quot;2020-02-27T01:47:32,863Z&quot;, &quot;level&quot;: &quot;WARN&quot;, &quot;component&quot;: &quot;o.e.b.ElasticsearchUncaughtExceptionHandler&quot;, &quot;cluster.name&quot;: &quot;docker-cluster&quot;, &quot;node.name&quot;: &quot;elasticsearch-0&quot;, &quot;message&quot;: &quot;uncaught exception in thread [main]&quot;, 
&quot;stacktrace&quot;: [&quot;org.elasticsearch.bootstrap.StartupException: java.lang.IllegalStateException: security initialization failed&quot;,
&quot;at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:163) ~[elasticsearch-7.5.1.jar:7.5.1]&quot;,
...

&quot;Caused by: java.lang.IllegalStateException: Unable to create a IDTokenValidator instance&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectAuthenticator.createIdTokenValidator(OpenIdConnectAuthenticator.java:619) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectAuthenticator.&lt;init&gt;(OpenIdConnectAuthenticator.java:143) ~[?:?]&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectRealm.&lt;init&gt;(OpenIdConnectRealm.java:116) ~[?:?]&quot;,
</code></pre>
<pre><code class="lang-sh">&quot;Caused by: java.lang.IllegalStateException: security initialization failed&quot;,
...

&quot;Caused by: java.lang.IllegalStateException: Unable to create a IDTokenValidator instance&quot;,
&quot;at org.elasticsearch.xpack.security.authc.oidc.OpenIdConnectAuthenticator.createIdTokenValidator(OpenIdConnectAuthenticator.java:619) ~[?:?]&quot;,
...

&quot;Caused by: java.nio.file.NoSuchFileException: /usr/share/elasticsearch/config/oidc/jwkset.json&quot;,
&quot;at sun.nio.fs.UnixException.translateToIOException(UnixException.java:92) ~[?:?]&quot;,
</code></pre>
<blockquote>
<p><strong>op.jwkset_path</strong></p>
<p>The path to a file or a URL containing a JSON Web Key Set with the key material that the OpenID Connect Provider uses for signing tokens and claims responses.</p>
</blockquote>
<p><strong>&#x5F53;&#x524D;&#x9519;&#x8BEF;&#x539F;&#x56E0;&#xFF1A;&#x7F3A;&#x5C11;JSON Web&#x5BC6;&#x94A5;&#x96C6;&#x7684;&#x6587;&#x4EF6;&#x6216;URL&#xFF0C;&#x9700;&#x7531;STS&#x63D0;&#x4F9B; op.jwkset_path &#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x5C1D;&#x8BD5;&#x3002;</strong></p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; Zeng 2019 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">Modified @
2020-12-12 17:04:11
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="k8s-elk-auth-kibana-via-ad.html" class="navigation navigation-prev " aria-label="Previous page: K8s部署ELK并启用AD认证">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="elk-grafana.html" class="navigation navigation-next " aria-label="Next page: 使用Grafana">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"ELK部署整改","level":"4.1.6","depth":2,"next":{"title":"使用Grafana","level":"4.1.7","depth":2,"path":"docs/log-analysis/elk-grafana.md","ref":"docs/log-analysis/elk-grafana.md","articles":[]},"previous":{"title":"K8s部署ELK并启用AD认证","level":"4.1.5","depth":2,"path":"docs/log-analysis/k8s-elk-auth-kibana-via-ad.md","ref":"docs/log-analysis/k8s-elk-auth-kibana-via-ad.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","-highlight","-livereload","-sharing","search-plus","simple-page-toc","editlink","splitter","tbfed-pagefooter","chapter-fold","sectionx","anchor-navigation-ex","code","todo","pageview-count","hide-element","fancybox"],"root":".","styles":{"website":"/styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © Zeng 2019","modify_label":"Modified @","modify_format":"YYYY-MM-DD HH:mm:ss"},"chapter-fold":{},"fancybox":{"helpers":{"buttons":{}}},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/zlzgithub/docs/blob/master/"},"simple-page-toc":{"maxDepth":3,"skipFirstH1":true},"todo":{},"splitter":{},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link",".treeview__container-title"]},"fontsettings":{"theme":"white","family":"sans","size":2},"sectionx":{"tag":"b"},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":false},"pageview-count":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"search-plus":{}},"theme":"default","author":"Zeng","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"DevOps Pages","language":"zh-hans","output.name":"site","gitbook":"3.2.3","description":"运维笔记"},"file":{"path":"docs/log-analysis/k8s-elk-improvement.md","mtime":"2020-12-12T17:04:11.825Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-12T17:07:54.823Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

